{"status":{},"contains_secrets":false,"product_version":"2.9.8","spec":{"description":"","resources":{"client_attrs":{"3a942096-0de8-7999-ec5d-e4541bd02ad8":{"y":301.1245745134,"x":491.7520252321},"4da04da8_deployment":{"y":140.8745727539,"x":216.5020141602},"d08f0247_deployment":{"y":301.1245745134,"x":491.7520252321}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"container1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e538d854_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ef3edbdf_runbook","main_task_local_reference":{"kind":"app_task","name":"e538d854_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"container1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6a3747b6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7577048d_runbook","main_task_local_reference":{"kind":"app_task","name":"6a3747b6_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"container1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2d2066b9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f6b8e74d_runbook","main_task_local_reference":{"kind":"app_task","name":"2d2066b9_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"container1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6f0baa01_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a92d3460_runbook","main_task_local_reference":{"kind":"app_task","name":"6f0baa01_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"container1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a74f66fb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"54e7fd27_runbook","main_task_local_reference":{"kind":"app_task","name":"a74f66fb_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"PVC"}],"name":"container1","port_list":[],"tier":"","container_spec":{"args":["sleep","1000"],"volumeMounts":[{"mountPath":"\/var\/lib\/mysql","name":"mysql-persistent-storage"}],"ports":[{"protocol":"TCP","containerPort":8080}],"name":"container1"},"variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"PVC"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"566ff929_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"31d3f359_runbook","main_task_local_reference":{"kind":"app_task","name":"566ff929_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"PVC"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e34eed21_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9bf3840c_runbook","main_task_local_reference":{"kind":"app_task","name":"e34eed21_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"PVC"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"f5a7689f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0860a64f_runbook","main_task_local_reference":{"kind":"app_task","name":"f5a7689f_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"PVC"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"948beb13_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"1a170168_runbook","main_task_local_reference":{"kind":"app_task","name":"948beb13_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"PVC"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"862ed7d8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5a0f2893_runbook","main_task_local_reference":{"kind":"app_task","name":"862ed7d8_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"PVC","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"K8S_POD","name":"POD1","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"","delay_secs":"60","disable_readiness_probe":false},"os_type":"Linux","create_spec":{"metadata":{"labels":{"app":"demo"},"namespace":"default","name":"POD"},"type":"PROVISION_K8S_POD","spec":{"restartPolicy":"Always","volumes":[{"name":"mysql-persistent-storage","persistentVolumeClaim":{"claimName":"@@{kube_pvc_name}@@"}}]},"account_uuid":"8ed309b3-c6a1-b30f-b8e2-fcaef8bb1089"},"variable_list":[]},{"description":"","action_list":[],"type":"EXISTING_VM","name":"pvcK8s","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{ip_address}@@","delay_secs":"60","disable_readiness_probe":true},"os_type":"Linux","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"127.0.0.1"},"variable_list":[]}],"credential_definition_list":[{"username":"dummy","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"dummy"}],"package_definition_list":[{"image_spec":{"image":"busybox","imagePullPolicy":"Always"},"description":"","action_list":[],"type":"K8S_IMAGE","service_local_reference_list":[{"kind":"app_service","name":"container1"}],"name":"Package1","version":"","variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"PVC"}],"name":"Package2","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Create_PVC"}],"name":"6dfc169f_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"PVC"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Create_PVC","state":"ACTIVE","attrs":{"script":"pvc_name = '@@{kube_pvc_name}@@'.lower()\n\nurl     = \"https:\/\/@@{kubemaster_ip}@@:443\/api\/v1\/namespaces\/@@{kube_namespace}@@\/persistentvolumeclaims\"\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json', 'Authorization': 'Bearer @@{kube_calm_sa_token}@@'}\n\npayload = {\n  \"apiVersion\": \"v1\",\n  \"kind\": \"PersistentVolumeClaim\",\n  \"metadata\": {\n    \"name\": pvc_name,\n    \"namespace\": \"@@{kube_namespace}@@\"\n  },\n  \"spec\": {\n    \"accessModes\": [\n      \"@@{kube_pvc_accessMode}@@\"\n    ],\n    \"resources\": {\n      \"requests\": {\n        \"storage\": \"@@{kube_pvc_size}@@\"\n      }\n    },\n    \"storageClassName\": \"@@{kube_pvc_storageClass}@@\",\n    \"volumeMode\": \"Filesystem\"\n  }\n}\n\n\nresp = urlreq(url, verb='POST', params=json.dumps(payload), headers=headers)\n\nif resp.ok:\n  print json.dumps(json.loads(resp.content), indent=4)\nelse:\n  print \"Post K8S Job request failed\", json.dumps(json.loads(resp.content), indent=4)\n  exit(1)","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0d8f4823_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"6dfc169f_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"24f68dba_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2429a0e5_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"24f68dba_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"K8S_DEPLOYMENT","action_list":[],"name":"d08f0247_deployment","min_replicas":"@@{number_of_replicas}@@","default_replicas":"@@{number_of_replicas}@@","depends_on_list":[],"editables":{"options":{"spec":{}}},"published_service_local_reference_list":[{"kind":"app_published_service","name":"calm_published_service1"}],"max_replicas":"100","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"POD1"},"options":{"type":"PROVISION_K8S_DEPLOYMENT","spec":{"replicas":"@@{number_of_replicas}@@","selector":{"matchLabels":{"app":"demo"}}},"metadata":{"labels":{"app":"demo"},"namespace":"default","name":"k8sdep-@@{calm_random_hash}@@"}},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"4da04da8_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package2"}],"substrate_local_reference":{"kind":"app_substrate","name":"pvcK8s"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Task1"}],"name":"f9144f33_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d08f0247_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Task1","attrs":{"scaling_count":"@@{number_of_replicas}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"d138b126_runbook","main_task_local_reference":{"kind":"app_task","name":"f9144f33_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"number_of_replicas","value":"1","label":"Replicas","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"name":"Scale out"}],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"kube_namespace","value":"default","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"kube_pvc_name","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"kube_pvc_storageClass","value":"default-storageclass","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"kube_pvc_accessMode","value":"ReadWriteOnce","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":["ReadWriteOnce","ReadOnlyMany","ReadWriteMany"]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"kube_pvc_size","value":"20Gi","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"kube_calm_sa_token","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":false},"is_hidden":true,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"kubemaster_ip","value":"192.168.4.2","label":"","attrs":{"type":""},"editables":{"value":false},"is_hidden":true,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"number_of_replicas","value":"1","label":"Replicas","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[{"singleton":true,"action_list":[],"type":"K8S_SERVICE","depends_on_list":[],"name":"calm_published_service1","port_list":[],"tier":"","options":{"type":"PROVISION_K8S_SERVICE","spec":{"type":"ClusterIP","ports":[{"protocol":"TCP","targetPort":8080,"name":"","port":8080}],"selector":{"app":"demo"}},"metadata":{"labels":{"app":"demo"},"namespace":"default","name":"k8spublishedservice-@@{calm_random_hash}@@"}},"variable_list":[],"description":""}],"default_credential_local_reference":{"kind":"app_credential","name":"dummy"},"type":"USER"},"name":"kalm-busybox-pvc"},"api_version":"3.0","metadata":{"last_update_time":"1585055980375562","kind":"blueprint","spec_version":19,"creation_time":"1584521968545077","name":"kalm-busybox-pvc"}}