{"status":{},"contains_secrets":false,"product_version":"2.9.8","spec":{"description":"","resources":{"client_attrs":{},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7debe36e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"773f9252_runbook","main_task_local_reference":{"kind":"app_task","name":"7debe36e_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a994383a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"03213edf_runbook","main_task_local_reference":{"kind":"app_task","name":"a994383a_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d2e4f050_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"14e6862d_runbook","main_task_local_reference":{"kind":"app_task","name":"d2e4f050_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9610dc6f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"18967c29_runbook","main_task_local_reference":{"kind":"app_task","name":"9610dc6f_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7714b84a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"240095fd_runbook","main_task_local_reference":{"kind":"app_task","name":"7714b84a_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Service","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AZURE_VM","name":"VM1","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"cred_os"}},"editables":{"create_spec":{"resources":{"storage_profile":{"data_disk_list":true,"image_details":{"sku":true,"publisher":true,"version":true,"offer":true}},"hw_profile":{"vm_size":true},"nw_profile":{"nic_list":true}}}},"os_type":"Linux","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"vm-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"7.6","publisher":"OpenLogic","offer":"CentOS","source_image_id":"","use_custom_image":false,"version":"7.6.201909120","type":""},"type":"","os_disk_details":{"size_in_gb":-1,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"","caching_type":"ReadWrite","type":"","create_option":"FromImage","lun":-1},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"","vnet_name":"","subnet_id":"\/subscriptions\/575bd7ed-618c-4a20-a50b-d4501433f5d2\/resourceGroups\/UK\/providers\/Microsoft.Network\/virtualNetworks\/calmvn\/subnets\/default","nsg_id":"\/subscriptions\/575bd7ed-618c-4a20-a50b-d4501433f5d2\/resourceGroups\/UK\/providers\/Microsoft.Network\/networkSecurityGroups\/calmnsg","private_ip_info":{"ip_allocation_method":"Dynamic","ip_address":"","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"","vnet_id":"\/subscriptions\/575bd7ed-618c-4a20-a50b-d4501433f5d2\/resourceGroups\/UK\/providers\/Microsoft.Network\/virtualNetworks\/calmvn","type":"","public_ip_info":{"ip_allocation_method":"Dynamic","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","type":""}}],"primary_nic":-1,"type":""},"resource_group":"UK","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":{"type":"","disable_password_auth":false,"public_keys":[],"custom_data":"#cloud-config\nhostname: @@{name}@@\nusers:\n  - name: @@{cred_os.username}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\nchpasswd:\n  list: |\n    @@{cred_os.username}@@:@@{cred_os.secret}@@\n  expire: False\nssh_pwauth: True"}},"hw_profile":{"max_data_disk_count":4,"vm_size":"Standard_B2s","type":""},"location":"uksouth","availability_set_id":"","tag_list":[],"type":"","account_uuid":"1739d129-eecf-0bd6-1332-64f8e104ef93"}},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"cred_os","editables":{"username":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Service"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Azure_Enable_Boot_Diagnostics"}],"name":"983208a9_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Azure_Enable_Boot_Diagnostics","state":"ACTIVE","attrs":{"script":"az_subscription_id = '@@{azure_subscription_id}@@'\naz_client_id = '@@{azure_client_id}@@'\naz_tenant_id = '@@{azure_tenant_id}@@'\naz_secret = '@@{azure_secret}@@'\naz_resource_group_name = '@@{resource_group}@@'\naz_vm_name = '@@{name}@@'\naz_location = '@@{platform.azureData.location}@@' \naz_storage_account_name = '@@{azure_storage_account_name}@@'\n\nfrom azure.common.credentials import ServicePrincipalCredentials\nfrom azure.mgmt.compute import ComputeManagementClient\n\ndef get_credentials():\n    subscription_id = az_subscription_id\n    credentials = ServicePrincipalCredentials(\n        client_id=az_client_id,\n        secret=az_secret,\n        tenant=az_tenant_id\n    )\n    return credentials, subscription_id\n\ndef set_bootDiagnostics():\n    credentials, subscription_id = get_credentials()\n    compute_client = ComputeManagementClient(credentials, subscription_id)\n\n    # Set Boot diagnostics for the virtual machine\n    az_storage_uri = 'https:\/\/{}.blob.core.windows.net\/'.format(az_storage_account_name)\n    \n    async_vm_update = compute_client.virtual_machines.create_or_update(\n        az_resource_group_name,\n        az_vm_name,\n        {\n            'location': az_location,\n            'diagnostics_profile': {\n                'boot_diagnostics': {\n                    'enabled': True,\n                    'additional_properties': {},\n                    'storage_uri': az_storage_uri\n                }\n            }\n        }\n    )\n    print('\\nConfiguring Boot diagnostics. Please wait...')\n    async_vm_update.wait()\n    \n    # Get the virtual machine by name\n    print('\\nBoot diagnostics status')\n    virtual_machine = compute_client.virtual_machines.get(\n        az_resource_group_name,\n        az_vm_name,\n        expand='instanceview'\n    )\n\n    return virtual_machine.diagnostics_profile.boot_diagnostics\n    \nprint set_bootDiagnostics()","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7c8b7ee3_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"983208a9_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"135eb14b_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e8489117_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"135eb14b_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"d9a7e890_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"VM1"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"azure_subscription_id","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"azure_client_id","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"azure_tenant_id","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"azure_secret","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"azure_storage_account_name","value":"ukdiag275","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"cred_os"},"type":"USER"},"name":"azureSdk-BootDiagnostics"},"api_version":"3.0","metadata":{"last_update_time":"1585151914030824","kind":"blueprint","spec_version":14,"creation_time":"1585122178120487","categories":{"TemplateType":"Vm"},"name":"azureSdk-BootDiagnostics"}}