{"status":{},"spec":{"description":"Complete Multi-VM (Workload Driver\/Generator - Data Visualisation - Search\/Index) stack\n\nAccess:\n* esrally VM : ssh -i .\/keys.pem -l centos @@{Workload_Driver.address}@@\n\n* Elasticsearch VM Access : ssh -i .\/keys.pem -l centos @@{Search_Index.address}@@\n\n* Kibana VM Access : ssh -i .\/keys.pem -l centos @@{Data_Visualisation.address}@@\n\n* Kibana GUI : @@{Data_Visualisation.address}@@:@@{Data_Visualisation.kibana_port}@@","resources":{"client_attrs":{"None":{"y":205,"x":315.700012207},"d91be491_deployment":{"y":167.4885341751,"x":781.5985538206},"6f64a5b6_deployment":{"y":167.9500787711,"x":544.9186350739},"eaf47630_deployment":{"y":160.6420111299,"x":298.7150311325}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Workload_Driver"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e6058292_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5410f70d_runbook","main_task_local_reference":{"kind":"app_task","name":"e6058292_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Workload_Driver"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ecc361d1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bd6c8ea3_runbook","main_task_local_reference":{"kind":"app_task","name":"ecc361d1_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Workload_Driver"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5029502d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ff71e6ad_runbook","main_task_local_reference":{"kind":"app_task","name":"5029502d_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Workload_Driver"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"fed93384_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"76761dd3_runbook","main_task_local_reference":{"kind":"app_task","name":"fed93384_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Workload_Driver"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bc42484e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"79fc6870_runbook","main_task_local_reference":{"kind":"app_task","name":"bc42484e_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Workload_Driver","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Data_Visualisation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ed399508_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2fc0a03e_runbook","main_task_local_reference":{"kind":"app_task","name":"ed399508_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Data_Visualisation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0fb48c3b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2657e29c_runbook","main_task_local_reference":{"kind":"app_task","name":"0fb48c3b_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Data_Visualisation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3398a56d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"da74beff_runbook","main_task_local_reference":{"kind":"app_task","name":"3398a56d_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Data_Visualisation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"175fba89_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"09e5b76d_runbook","main_task_local_reference":{"kind":"app_task","name":"175fba89_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Data_Visualisation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"db18e747_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e42e8926_runbook","main_task_local_reference":{"kind":"app_task","name":"db18e747_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"Search_Index"}],"name":"Data_Visualisation","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Search_Index"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a3fb58c3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"59ccb354_runbook","main_task_local_reference":{"kind":"app_task","name":"a3fb58c3_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Search_Index"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6f06e3e3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ac0f4ff4_runbook","main_task_local_reference":{"kind":"app_task","name":"6f06e3e3_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Search_Index"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d078dcb2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"373d610e_runbook","main_task_local_reference":{"kind":"app_task","name":"d078dcb2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Search_Index"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7173da0d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8817a34e_runbook","main_task_local_reference":{"kind":"app_task","name":"7173da0d_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Search_Index"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"51fbb84f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d22495f1_runbook","main_task_local_reference":{"kind":"app_task","name":"51fbb84f_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Search_Index","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"esrallyAHV","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"esrally-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"5fbe16fc-55de-4eab-ab95-0e6a8bae0a4c"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_7_Cloud","uuid":"0df1a5fb-dc98-4ef8-8b98-671771eb3c5c"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":512000,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"KibanaAHV","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"kibana-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"5fbe16fc-55de-4eab-ab95-0e6a8bae0a4c"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_7_Cloud","uuid":"0df1a5fb-dc98-4ef8-8b98-671771eb3c5c"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"ElasticAHV","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"elastic-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"5fbe16fc-55de-4eab-ab95-0e6a8bae0a4c"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":8,"gpu_list":[],"memory_size_mib":65536,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_7_Cloud","uuid":"0df1a5fb-dc98-4ef8-8b98-671771eb3c5c"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":6,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS"}],"package_definition_list":[{"description":"CentOS 7 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_7_Cloud","version":"","options":{"type":"","name":"CentOS_7_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"7","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Workload_Driver"}],"name":"Package2","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"esrally_install"}],"name":"e41ea406_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Workload_Driver"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"esrally_install","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nset -ex\n\nsudo yum install -y yum-utils\nsudo yum install -y lsscsi lvm2 device-mapper-persistent-data\n\nDATA_DISK=$(\/usr\/bin\/lsscsi | egrep -v \"sda|sr0\" | tail -n 1 | awk '{print $NF}')\nsudo \/usr\/sbin\/pvcreate -y $DATA_DISK\nsudo \/usr\/sbin\/vgcreate rally $DATA_DISK\nsudo \/usr\/sbin\/lvcreate -y -l 100%VG -n rally rally\nsudo \/usr\/sbin\/mkfs.xfs \/dev\/mapper\/rally-rally\nsudo \/usr\/bin\/mkdir -p \/data\/rally\nsudo chown -R centos:centos \/data\/rally\nsudo \/usr\/bin\/mount \/dev\/mapper\/rally-rally \/data\/rally\nsudo echo -e \"\/dev\/mapper\/rally-rally \\t \/data\/rally \\t xfs \\t defaults,auto,noexec \\t 0 0\" | sudo tee \/etc\/fstab\n\n#sudo yum update yum -y\nsudo yum install -y wget\nsudo yum install -y java-1.8.0-openjdk-devel\n\nsudo yum install -y https:\/\/centos7.iuscommunity.org\/ius-release.rpm\nsudo yum install -y gcc python36u.x86_64 python36u-devel.x86_64 python36u-pip.noarch\n#sudo \/usr\/bin\/yum install -y git\n\n#sudo yum groupinstall -y \"Development Tools\"\nsudo yum install -y gettext-devel openssl-devel perl-CPAN perl-devel zlib-devel curl-devel\nsudo yum install -y autoconf autogen\nsudo \/usr\/bin\/wget https:\/\/github.com\/git\/git\/archive\/v2.21.0.tar.gz -O git.tar.gz\nsleep 30\nsudo \/usr\/bin\/tar xvf ~\/git.tar.gz\ncd ~\/git-2.21.0\n#pwd\nsudo \/usr\/bin\/make configure\nsudo .\/configure --prefix=\/usr\/local\nsudo \/usr\/bin\/make install \n\nsudo pip3.6 install psutil\nsudo pip3.6 install esrally\nesrally configure --advanced-config <<EOF\n\/data\/rally\/.rally\/benchmarks\n\/data\/rally\/.rally\/benchmarks\/src\/elasticsearch\n1\nFalse\nEOF\n\nsudo echo -e '\\nConfiguration successfully written to \/home\/centos\/.rally\/rally.ini. Happy benchmarking!\\n\\n\nMore info about Rally:\\n\\n\n* Type esrally --help\\n\n* Read the documentation at https:\/\/esrally.readthedocs.io\/en\/1.2.1\/\\n\n* Ask a question on the forum at https:\/\/discuss.elastic.co\/c\/elasticsearch\/rally\\n\\n\nTo get started:\\n\n\\tesrally list tracks\\n\\n\n\\tOr....\\n\\n\n\\tesrally --pipeline=benchmark-only --target-hosts=@@{Search_Index.address}@@:@@{Search_Index.elastic_http_port}@@ \\\n\\t--track=eventdata --track-repository=eventdata --challenge=bulk-size-evaluation\\n' | sudo tee \/etc\/motd\n\nsed -i.bkp '\/default.url \\= https:\\\/\\\/github.com\\\/elastic\\\/rally-tracks\/a eventdata.url \\= https:\\\/\\\/github.com\\\/elastic\\\/rally-eventdata-track' \/home\/centos\/.rally\/rally.ini\nsudo mkdir -p \/data\/rally\/.rally\/benchmarks\/tracks\nsudo git clone https:\/\/github.com\/elastic\/rally-eventdata-track \/data\/rally\/.rally\/benchmarks\/tracks\/eventdata\nsudo chown centos:centos -R \/data\/rally\/.rally\/benchmarks\/tracks\n\nsudo systemctl stop firewalld || true\nsudo systemctl disable firewalld || true\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"f0f0ceb9_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"e41ea406_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"30ebfeb1_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"95609990_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"30ebfeb1_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Data_Visualisation"}],"name":"Package3","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Kibana_Install"}],"name":"7cc7141d_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Data_Visualisation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Kibana_Install","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash \n\nset -ex\n\nHOST=$(hostname)\n#echo $HOST\n\nsudo yum install -y wget\nsudo \/usr\/bin\/rpm --import https:\/\/artifacts.elastic.co\/GPG-KEY-elasticsearch\n\nsudo wget https:\/\/artifacts.elastic.co\/downloads\/kibana\/kibana-7.0.1-x86_64.rpm\nsudo \/usr\/bin\/yum localinstall -y kibana-7.0.1-x86_64.rpm\n\n#IP_ADDRESS=$(ip a show dev eth0 | grep -w inet | awk '{print $2}' | sed 's\/\\\/22\/\/')\nsudo sed -i 's\/^#server.port: 5601\/server.port: @@{kibana_port}@@\/' \/etc\/kibana\/kibana.yml\nsudo sed -i 's\/^#server.host: \"localhost\"\/server.host: @@{KibanaAHV.address}@@\/' \/etc\/kibana\/kibana.yml\nsudo sed -i \"s\/^#server.name: \\\"your-hostname\\\"\/server.name: $HOST\/\" \/etc\/kibana\/kibana.yml\nsudo sed -i 's%^#elasticsearch.hosts: \\[\"http:\/\/localhost:9200\"\\]%elasticsearch.hosts: \\[\"http:\/\/@@{Search_Index.address}@@:@@{elastic_http_port}@@\"\\]%' \/etc\/kibana\/kibana.yml\n\nsudo \/bin\/systemctl stop firewalld || true\nsudo \/bin\/systemctl disable firewalld || true\n\nsudo \/bin\/systemctl daemon-reload\nsudo \/bin\/systemctl enable kibana.service\nsudo \/bin\/systemctl start kibana.service\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"9f470d75_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"7cc7141d_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"a9bf2e5c_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a9d402f1_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"a9bf2e5c_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Search_Index"}],"name":"Package4","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package4"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Elastic_Install"}],"name":"654bff4d_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Search_Index"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Elastic_Install","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nset -ex\n\nsudo \/usr\/sbin\/swapoff -a \nsudo sed -i '\/swap\/ s\/^\/#\/' \/etc\/fstab\n\nsudo yum install -y lsscsi yum-utils wget\nsudo yum install -y lvm2 device-mapper-persistent-data\nsudo yum install -y java-1.8.0-openjdk-devel\n\nsudo rpm --import https:\/\/artifacts.elastic.co\/GPG-KEY-elasticsearch\nsudo wget https:\/\/artifacts.elastic.co\/downloads\/elasticsearch\/elasticsearch-7.0.1-x86_64.rpm\nsudo yum localinstall -y elasticsearch-7.0.1-x86_64.rpm \n\nsudo sed -i 's\/#cluster.name: my-application\/cluster.name: @@{elastic_cluster_name}@@\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/#node.name: node-1\/node.name: ${HOSTNAME}\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i '$ a node.data: true' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i '$ a node.master: true' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's%path.data: \/var\/lib\/elasticsearch%path.data: @@{elastic_data_path}@@%' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/^#bootstrap\/bootstrap\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/^#network.host: 192.168.0.1\/network.host: _eth0:ipv4_\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/^#http.port: 9200\/http.port: @@{elastic_http_port}@@\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/^#discovery.zen.minimum_master_nodes:\/discovery.zen.minimum_master_nodes: 1\/' \/etc\/elasticsearch\/elasticsearch.yml  \nsudo sed -i 's\/#discovery.seed_hosts: \\[\"host1\", \"host2\"\\]\/discovery.seed_hosts: [\"@@{address}@@\"]\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/#cluster.initial_master_nodes: \\[\"node-1\", \"node-2\"\\]\/cluster.initial_master_nodes: [\"@@{address}@@\"]\/' \/etc\/elasticsearch\/elasticsearch.yml\nsudo sed -i 's\/-Xms1g\/-Xms@@{java_heap_size}@@g\/' \/etc\/elasticsearch\/jvm.options\nsudo sed -i 's\/-Xmx1g\/-Xmx@@{java_heap_size}@@g\/' \/etc\/elasticsearch\/jvm.options\n\nsudo echo -e \"vm.swappiness=0\\nvm.max_map_count=262144\\nvm.dirty_background_ratio=1\\nvm.dirty_ratio=40\" | sudo tee \/etc\/sysctl.d\/vm.conf\n\nsudo mkdir -p \/etc\/systemd\/system\/elasticsearch.service.d\nsudo echo -e \"[Service]\\nLimitMEMLOCK=infinity\" | sudo tee \/etc\/systemd\/system\/elasticsearch.service.d\/override.conf\n\nsudo \/usr\/sbin\/sysctl --system\n\nsudo echo -e 'ACTION==\"add|change\", KERNEL==\"sd[b-g]\", ATTR{queue\/scheduler}=\"noop\"\\n'\\\n'ACTION==\"add|change\", KERNEL==\"sd[b-g]\", ATTR{queue\/nr_requests}=\"128\"\\n'\\\n'ACTION==\"add|change\", KERNEL==\"sd[b-g]\", ATTR{queue\/max_sectors_kb}=\"1024\"'\\\n | sudo tee \/etc\/udev\/rules.d\/99-nutanix.rules\n \nsudo udevadm -d control --reload-rules\nsudo udevadm trigger --type=devices --action=change\n\n#\/usr\/bin\/lsscsi | \/usr\/bin\/awk '{print $6}' | \/usr\/bin\/grep \/dev\/sd | \/usr\/bin\/grep -v sda | \/usr\/bin\/xargs pvcreate\nDISKS=$(\/usr\/bin\/lsscsi | \/usr\/bin\/egrep -v \"sr|sda\" | \/usr\/bin\/awk '{print $NF}' | \/usr\/bin\/tr '\\n' ' ')\nsudo \/usr\/sbin\/pvcreate $(echo $DISKS)\nsudo \/usr\/sbin\/vgcreate esdata $(echo $DISKS)\nsudo \/usr\/sbin\/lvcreate -y -i 6 -l 100%VG -n esdata esdata\nsudo \/usr\/sbin\/mkfs.xfs \/dev\/mapper\/esdata-esdata\nsudo sleep 30\nsudo \/usr\/bin\/mkdir -p \/elastic\/esdata01\nsudo \/usr\/bin\/mount \/dev\/mapper\/esdata-esdata @@{elastic_data_path}@@\nsudo echo -e \"\/dev\/mapper\/esdata-esdata \\t @@{elastic_data_path}@@ \\t xfs \\t defaults,auto,noexec \\t 0 0\" | sudo tee \/etc\/fstab\nsudo \/usr\/bin\/chown -R elasticsearch:elasticsearch \/elastic\/esdata01\n\nsudo \/bin\/systemctl stop firewalld || true\nsudo \/bin\/systemctl disable firewalld || true\n\nsudo \/bin\/systemctl daemon-reload\nsudo \/bin\/systemctl enable elasticsearch.service\nsudo \/bin\/systemctl start elasticsearch.service\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"f1394cdd_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"654bff4d_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package4"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"7d1594f1_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9a4cf335_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"7d1594f1_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"eaf47630_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package2"}],"substrate_local_reference":{"kind":"app_substrate","name":"esrallyAHV"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"6f64a5b6_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package3"}],"substrate_local_reference":{"kind":"app_substrate","name":"KibanaAHV"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"d91be491_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package4"}],"substrate_local_reference":{"kind":"app_substrate","name":"ElasticAHV"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[],"name":"Nutanix","variable_list":[{"val_type":"STRING","description":"","name":"INSTANCE_PUBLIC_KEY","type":"LOCAL","value":"ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAii7qFDhVadLx5lULAG\/ooCUTA\/ATSmXbArs+GdHxbUWd\/bNGZCXnaQ2L1mSVVGDxfTbSaTJ3En3tVlMtD2RjZPdhqWESCaoj2kXLYSiNDS9qz3SK6h822je\/f9O9CzCTrw2XGhnDVwmNraUvO5wmQObCDthTXc72PcBOd6oa4ENsnuY9HtiETg29TZXgCYPFXipLBHSZYkBmGgccAeY9dq5ywiywBJLuoSovXkkRJk3cd7GyhCRIwYzqfdgSmiAMYgJLrz\/UuLxatPqXts2D8v1xqR9EPNZNzgd4QHK4of1lqsNRuz2SxkwqLcXSw0mGcAL8mIwVpzhPzwmENC5Orw== rsa-key-20190108","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"kibana_port","type":"LOCAL","value":"5601","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"java_heap_size","type":"LOCAL","value":"31","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"elastic_http_port","type":"LOCAL","value":"9200","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"elastic_cluster_name","type":"LOCAL","value":"ntnx","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"elastic_data_path","type":"LOCAL","value":"\/elastic\/esdata01","label":""}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"esrally_elasticstack_benchmarking"},"api_version":"3.0","metadata":{"last_update_time":"1563378079797794","kind":"blueprint","spec_version":64,"creation_time":"1556969055647513","name":"esrally_elasticstack_benchmarking"}}